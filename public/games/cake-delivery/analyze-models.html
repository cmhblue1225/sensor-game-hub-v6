<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLB ëª¨ë¸ ë¶„ì„ê¸°</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 20px;
        }
        
        .analysis-section {
            background: #2a2a2a;
            border: 1px solid #00ff00;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .model-name {
            color: #ffff00;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .loading {
            color: #ff6600;
            font-style: italic;
        }
        
        .error {
            color: #ff0000;
            font-weight: bold;
        }
        
        .success {
            color: #00ff00;
        }
        
        .info {
            color: #00ccff;
        }
        
        .warning {
            color: #ffaa00;
        }
        
        pre {
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 15px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        button:hover {
            background: #00cc00;
        }
        
        .progress {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #ffff00);
            width: 0%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” GLB ëª¨ë¸ ë¶„ì„ê¸°</h1>
            <p>ì¼€ì´í¬ ë°°ë‹¬ ê²Œì„ì˜ GLB ëª¨ë¸ë“¤ì„ ìƒì„¸ ë¶„ì„í•©ë‹ˆë‹¤</p>
            <button onclick="startAnalysis()">ğŸš€ ë¶„ì„ ì‹œì‘</button>
            <button onclick="clearResults()">ğŸ—‘ï¸ ê²°ê³¼ ì§€ìš°ê¸°</button>
        </div>
        
        <div id="progressSection" style="display: none;">
            <h3>ë¶„ì„ ì§„í–‰ë¥ </h3>
            <div class="progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div id="progressText">ì¤€ë¹„ ì¤‘...</div>
        </div>
        
        <div id="resultsContainer"></div>
    </div>
    
    <!-- Three.js ë° GLTFLoader -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/loaders/GLTFLoader.js"></script>
    
    <!-- GLB ë¶„ì„ê¸° -->
    <script src="js/tools/GLBAnalyzer.js"></script>
    
    <script>
        let analyzer = null;
        let analysisInProgress = false;
        
        // ë¶„ì„í•  GLB ëª¨ë¸ë“¤
        const modelsToAnalyze = [
            { path: 'anim/glbs/idle.glb', name: 'idle' },
            { path: 'anim/glbs/original.glb', name: 'original' },
            { path: 'anim/glbs/pulling.glb', name: 'pulling' },
            { path: 'anim/glbs/pushing.glb', name: 'pushing' }
        ];
        
        async function startAnalysis() {
            if (analysisInProgress) {
                console.log('âš ï¸ ë¶„ì„ì´ ì´ë¯¸ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.');
                return;
            }
            
            analysisInProgress = true;
            analyzer = new GLBAnalyzer();
            
            const progressSection = document.getElementById('progressSection');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const resultsContainer = document.getElementById('resultsContainer');
            
            progressSection.style.display = 'block';
            resultsContainer.innerHTML = '';
            
            console.log('ğŸš€ GLB ëª¨ë¸ ë¶„ì„ ì‹œì‘');
            
            for (let i = 0; i < modelsToAnalyze.length; i++) {
                const model = modelsToAnalyze[i];
                const progress = ((i + 1) / modelsToAnalyze.length) * 100;
                
                progressBar.style.width = `${progress}%`;
                progressText.textContent = `ë¶„ì„ ì¤‘: ${model.name} (${i + 1}/${modelsToAnalyze.length})`;
                
                // ê²°ê³¼ ì„¹ì…˜ ìƒì„±
                const section = document.createElement('div');
                section.className = 'analysis-section';
                section.id = `analysis-${model.name}`;
                section.innerHTML = `
                    <div class="model-name">ğŸ“¦ ${model.name.toUpperCase()}</div>
                    <div class="loading">ë¶„ì„ ì¤‘...</div>
                `;
                resultsContainer.appendChild(section);
                
                try {
                    const analysis = await analyzer.analyzeGLB(model.path, model.name);
                    displayAnalysisResult(model.name, analysis);
                } catch (error) {
                    displayAnalysisError(model.name, error);
                }
            }
            
            progressText.textContent = 'ë¶„ì„ ì™„ë£Œ!';
            analysisInProgress = false;
            
            // ì¢…í•© ë¶„ì„ ê²°ê³¼ í‘œì‹œ
            displaySummary();
            
            console.log('âœ… ëª¨ë“  GLB ëª¨ë¸ ë¶„ì„ ì™„ë£Œ');
        }
        
        function displayAnalysisResult(modelName, analysis) {
            const section = document.getElementById(`analysis-${modelName}`);
            
            const html = `
                <div class="model-name">ğŸ“¦ ${modelName.toUpperCase()}</div>
                <div class="success">âœ… ë¶„ì„ ì™„ë£Œ</div>
                
                <h4 class="info">ğŸ“Š ê¸°ë³¸ ì •ë³´</h4>
                <pre>
ì”¬ ì´ë¦„: ${analysis.scene.name}
ì˜¤ë¸Œì íŠ¸ ìˆ˜: ${analysis.scene.objects.length}
ì´ ë²„í…ìŠ¤: ${analysis.geometry.totalVertices.toLocaleString()}
ì´ ì‚¼ê°í˜•: ${analysis.geometry.totalTriangles.toLocaleString()}
ì¬ì§ˆ ìˆ˜: ${analysis.materials.count}
í…ìŠ¤ì²˜ ìˆ˜: ${analysis.textures.count}
ì˜ˆìƒ ë©”ëª¨ë¦¬: ${(analysis.textures.totalMemoryEstimate / 1024 / 1024).toFixed(2)}MB
                </pre>
                
                <h4 class="info">ğŸ¬ ì• ë‹ˆë©”ì´ì…˜ ì •ë³´</h4>
                <pre>
ì• ë‹ˆë©”ì´ì…˜ ìˆ˜: ${analysis.animations.count}
${analysis.animations.animations.map(anim => 
    `- ${anim.name}: ${anim.duration.toFixed(2)}ì´ˆ, ${anim.trackCount}ê°œ íŠ¸ë™`
).join('\n')}
                </pre>
                
                <h4 class="info">ğŸ¨ ì¬ì§ˆ ì •ë³´</h4>
                <pre>
${analysis.materials.materials.map(mat => 
    `- ${mat.name} (${mat.type})${mat.pbr ? `\n  PBR: ê±°ì¹ ê¸°=${mat.pbr.roughness}, ê¸ˆì†ì„±=${mat.pbr.metalness}` : ''}`
).join('\n')}
                </pre>
                
                <h4 class="info">ğŸ¦´ ë³¸(Bone) ì •ë³´</h4>
                <pre>
ìŠ¤ì¼ˆë ˆí†¤ ìˆìŒ: ${analysis.bones.hasSkeleton ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}
ë³¸ ê°œìˆ˜: ${analysis.bones.boneCount}
${analysis.bones.bones.slice(0, 5).map(bone => 
    `- ${bone.name}: ìœ„ì¹˜[${bone.position.map(v => v.toFixed(2)).join(', ')}]`
).join('\n')}
${analysis.bones.bones.length > 5 ? `... ë° ${analysis.bones.bones.length - 5}ê°œ ë”` : ''}
                </pre>
                
                <h4 class="info">ğŸ“ í¬ê¸° ì •ë³´</h4>
                <pre>
ë°”ìš´ë”© ë°•ìŠ¤ í¬ê¸°: ${analysis.boundingBox.size.map(v => v.toFixed(2)).join(' x ')}
ì¤‘ì‹¬ì : ${analysis.boundingBox.center.map(v => v.toFixed(2)).join(', ')}
ë¶€í”¼: ${analysis.boundingBox.volume.toFixed(2)}
                </pre>
                
                <h4 class="info">ğŸ—ï¸ ê³„ì¸µ êµ¬ì¡°</h4>
                <pre>${formatHierarchy(analysis.scene.hierarchy)}</pre>
                
                ${analysis.recommendations.length > 0 ? `
                <h4 class="warning">ğŸ’¡ ìµœì í™” ê¶Œì¥ì‚¬í•­</h4>
                <pre>
${analysis.recommendations.map(rec => {
    const icon = rec.severity === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
    return `${icon} ${rec.message}`;
}).join('\n')}
                </pre>
                ` : ''}
            `;
            
            section.innerHTML = html;
        }
        
        function displayAnalysisError(modelName, error) {
            const section = document.getElementById(`analysis-${modelName}`);
            section.innerHTML = `
                <div class="model-name">ğŸ“¦ ${modelName.toUpperCase()}</div>
                <div class="error">âŒ ë¶„ì„ ì‹¤íŒ¨</div>
                <pre class="error">ì˜¤ë¥˜: ${error.message}</pre>
            `;
        }
        
        function formatHierarchy(hierarchy, indent = 0) {
            const spaces = '  '.repeat(indent);
            let result = `${spaces}${hierarchy.name} (${hierarchy.type})\n`;
            
            hierarchy.children.forEach(child => {
                result += formatHierarchy(child, indent + 1);
            });
            
            return result;
        }
        
        function displaySummary() {
            if (!analyzer) return;
            
            const allAnalysis = analyzer.getAllAnalysis();
            const summary = document.createElement('div');
            summary.className = 'analysis-section';
            summary.innerHTML = `
                <div class="model-name">ğŸ“‹ ì¢…í•© ë¶„ì„ ê²°ê³¼</div>
                <div class="success">ì´ ${allAnalysis.size}ê°œ ëª¨ë¸ ë¶„ì„ ì™„ë£Œ</div>
                
                <h4 class="info">ğŸ“Š í†µê³„</h4>
                <pre>
ì´ ë²„í…ìŠ¤: ${Array.from(allAnalysis.values()).reduce((sum, a) => sum + a.geometry.totalVertices, 0).toLocaleString()}
ì´ ì‚¼ê°í˜•: ${Array.from(allAnalysis.values()).reduce((sum, a) => sum + a.geometry.totalTriangles, 0).toLocaleString()}
ì´ ì• ë‹ˆë©”ì´ì…˜: ${Array.from(allAnalysis.values()).reduce((sum, a) => sum + a.animations.count, 0)}
ì´ ì˜ˆìƒ ë©”ëª¨ë¦¬: ${(Array.from(allAnalysis.values()).reduce((sum, a) => sum + a.textures.totalMemoryEstimate, 0) / 1024 / 1024).toFixed(2)}MB
                </pre>
                
                <h4 class="info">ğŸ¯ ê°œë°œ ê¶Œì¥ì‚¬í•­</h4>
                <pre>
1. ì• ë‹ˆë©”ì´ì…˜ ëª¨ë¸ë“¤ì€ ìŠ¤ì¼ˆë ˆí†¤ ì• ë‹ˆë©”ì´ì…˜ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
2. ëª¨ë“  ëª¨ë¸ì´ ì ì ˆí•œ í´ë¦¬ê³¤ ìˆ˜ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.
3. PBR ì¬ì§ˆì„ í™œìš©í•˜ì—¬ ê³ í’ˆì§ˆ ë Œë”ë§ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
4. LOD ì‹œìŠ¤í…œ êµ¬í˜„ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.
5. í…ìŠ¤ì²˜ ì••ì¶•ìœ¼ë¡œ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </pre>
            `;
            
            document.getElementById('resultsContainer').appendChild(summary);
        }
        
        function clearResults() {
            document.getElementById('resultsContainer').innerHTML = '';
            document.getElementById('progressSection').style.display = 'none';
            analysisInProgress = false;
            analyzer = null;
            console.log('ğŸ—‘ï¸ ë¶„ì„ ê²°ê³¼ ì§€ì›Œì§');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ë¶„ì„ ì‹œì‘
        window.addEventListener('load', () => {
            console.log('ğŸ” GLB ëª¨ë¸ ë¶„ì„ê¸° ì¤€ë¹„ ì™„ë£Œ');
            console.log('ë¶„ì„ì„ ì‹œì‘í•˜ë ¤ë©´ "ë¶„ì„ ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.');
        });
    </script>
</body>
</html>