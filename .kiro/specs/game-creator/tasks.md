# 구현 계획

## 개요

자동차 경주 3D 게임을 센서 게임 허브에 추가하기 위한 단계별 구현 계획입니다. 각 작업은 테스트 주도 개발 방식으로 진행하며, 기존 허브 시스템과의 호환성을 최우선으로 합니다.

## 작업 목록

- [x] 1. 프로젝트 구조 및 기본 파일 생성
  - 프로젝트 지침에 따른 `public/games/racing-3d/` 폴더 구조 생성
  - GAME_TEMPLATE.html을 기반으로 한 index.html 생성
  - 허브 호환 CSS 테마 변수 사용한 스타일 구현
  - 표준 game.json 메타데이터 파일 작성 (dual 카테고리)
  - _요구사항: 5.1, 5.2_

- [x] 2. SessionSDK 통합 및 기본 게임 초기화
  - SessionSDK를 사용한 듀얼 게임 세션 생성
  - `event.detail || event` 패턴으로 이벤트 처리 구현
  - 서버 연결 완료 후 세션 생성 로직 구현
  - QR 코드 생성 및 폴백 처리 구현
  - _요구사항: 5.3, 5.4_

- [x] 3. 게임 UI 및 화면 분할 시스템 구현
  - 세션 대기 화면 구현 (세션 코드, QR 코드 표시)
  - 좌우 화면 분할 레이아웃 구현
  - 플레이어별 HUD (속도, 랩 수, 시간) 구현
  - 게임 컨트롤 패널 (재시작, 일시정지, 허브로) 구현
  - _요구사항: 2.1, 2.4, 4.4_

- [x] 4. 3D 렌더링 엔진 설정
  - Three.js 라이브러리 통합
  - 화면 분할을 위한 듀얼 카메라 시스템 구현
  - 기본 3D 씬, 조명, 렌더러 설정
  - 반응형 캔버스 크기 조정 구현
  - _요구사항: 3.1_

- [x] 5. 3D 트랙 및 환경 생성
  - 기본 레이싱 트랙 지오메트리 생성
  - 트랙 경계 및 벽 생성
  - 시작선과 결승선 설정
  - 체크포인트 시스템 구현
  - 기본 환경 요소 (하늘, 지면) 추가
  - _요구사항: 3.1, 4.1_

- [x] 6. 물리 엔진 통합
  - Cannon.js 물리 엔진 설정
  - 트랙과 자동차를 위한 물리 바디 생성
  - 중력, 마찰력, 충돌 감지 설정
  - 물리 시뮬레이션과 3D 렌더링 동기화
  - _요구사항: 3.2, 3.4_

- [x] 7. 자동차 클래스 및 3D 모델 구현
  - Car 클래스 기본 구조 구현
  - 간단한 3D 자동차 모델 생성 (박스 지오메트리 기반)
  - 자동차 물리 바디와 3D 메시 연결
  - 자동차 초기 위치 및 회전 설정
  - _요구사항: 1.1, 2.2, 2.3_

- [x] 8. 센서 데이터 처리 및 자동차 조작 구현
  - 센서 데이터 수신 및 파싱 구현
  - 기울기 데이터를 자동차 조작으로 변환하는 로직 구현
  - 좌우 기울기 → 핸들 조작 매핑
  - 앞뒤 기울기 → 가속/브레이크 매핑
  - 센서 감도 조정 및 데이터 필터링
  - _요구사항: 1.1, 1.2, 1.3, 1.4_

- [x] 9. 게임 상태 관리 시스템 구현
  - 게임 상태 (waiting, racing, finished) 관리
  - 플레이어별 상태 추적 (위치, 속도, 랩 수)
  - 게임 시작 카운트다운 구현
  - 게임 일시정지 및 재개 기능
  - _요구사항: 4.4, 6.2_

- [x] 10. 랩 카운트 및 순위 시스템 구현
  - 체크포인트 통과 감지 로직
  - 랩 완주 판정 및 카운트 증가
  - 랩 타임 측정 및 기록
  - 실시간 순위 계산 및 표시
  - _요구사항: 4.1, 4.2_

- [x] 11. 충돌 감지 및 처리 구현
  - 자동차 간 충돌 감지 및 반응
  - 트랙 경계 충돌 처리
  - 트랙 이탈 시 자동차 리셋 기능
  - 충돌 시 속도 및 방향 조정
  - _요구사항: 3.3_

- [x] 12. 게임 종료 및 결과 표시 구현
  - 경주 완료 조건 확인 (3랩 완주)
  - 승자 결정 로직
  - 최종 결과 화면 구현
  - 최고 기록 및 통계 표시
  - _요구사항: 4.2, 4.3_

- [x] 13. 재시작 및 세션 관리 기능 구현
  - 재시작 버튼 클릭 시 게임 상태만 초기화
  - 센서 연결 및 세션 유지
  - 게임 종료 시 허브로 돌아가기 기능
  - 세션 정리 및 메모리 해제
  - _요구사항: 6.1, 6.4_

- [x] 14. 센서 연결 오류 처리 구현
  - 센서 연결 끊김 감지 및 게임 일시정지
  - 재연결 대기 메시지 표시
  - 센서 재연결 시 게임 재개
  - 연결 상태 UI 업데이트
  - _요구사항: 6.3_

- [x] 15. 키보드 테스트 기능 구현
  - 개발 및 테스트를 위한 키보드 조작 구현
  - 화살표 키로 자동차 조작
  - 센서 데이터와 키보드 입력 전환 기능
  - 디버그 모드 토글 기능
  - _요구사항: 1.1, 1.2, 1.3_

- [x] 16. 성능 최적화 및 렌더링 개선
  - 60fps 유지를 위한 렌더링 최적화
  - 센서 데이터 throttling (33ms 간격)
  - 메모리 사용량 최적화
  - 화면 분할 렌더링 성능 개선
  - _요구사항: 1.4, 2.1_

- [x] 17. 게임 테스트 및 버그 수정
  - 센서 연결 및 데이터 전송 테스트
  - 물리 엔진 동작 검증
  - 게임 플로우 전체 테스트
  - 크로스 브라우저 호환성 테스트
  - _요구사항: 모든 요구사항_

- [ ] 18. 게임 허브 통합 및 배포 준비
  - 게임 폴더를 public/games/에 배치
  - 서버 재시작 또는 /api/admin/rescan으로 게임 등록 확인
  - 허브 메인 페이지에서 게임 표시 확인
  - 최종 사용자 테스트 및 피드백 반영
  - _요구사항: 5.1, 5.4_